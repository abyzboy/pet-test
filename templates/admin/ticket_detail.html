{% extends "admin/base.html" %}

{% block title %}–ó–∞—è–≤–∫–∞ #{{ ticket.id }}{% endblock %}
{% block page_title %}üìù –ó–∞—è–≤–∫–∞ #{{ ticket.id }}{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
    <a href="/admin/tickets" style="color: #667eea; text-decoration: none; font-size: 14px;">
        ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∑–∞—è–≤–æ–∫
    </a>
</div>

<div class="content-box">
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
        <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div>
            <h2 style="font-size: 24px; color: #2c3e50; margin-bottom: 20px;">
                –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞—è–≤–∫–µ
            </h2>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; gap: 15px;">
                    <div>
                        <strong style="color: #7f8c8d; font-size: 12px; text-transform: uppercase;">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</strong>
                        <div style="font-size: 18px; color: #2c3e50; margin-top: 5px;">{{ ticket.name }}</div>
                    </div>

                    <div>
                        <strong style="color: #7f8c8d; font-size: 12px; text-transform: uppercase;">Email</strong>
                        <div style="font-size: 16px; color: #2c3e50; margin-top: 5px;">
                            <a href="mailto:{{ ticket.email }}" style="color: #667eea; text-decoration: none;">
                                {{ ticket.email }}
                            </a>
                        </div>
                    </div>

                    <div>
                        <strong style="color: #7f8c8d; font-size: 12px; text-transform: uppercase;">–¢–µ–ª–µ—Ñ–æ–Ω</strong>
                        <div style="font-size: 16px; color: #2c3e50; margin-top: 5px;">
                            <a href="tel:{{ ticket.phone }}" style="color: #667eea; text-decoration: none;">
                                {{ ticket.phone }}
                            </a>
                        </div>
                    </div>

                    <div>
                        <strong style="color: #7f8c8d; font-size: 12px; text-transform: uppercase;">–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞</strong>
                        <div style="font-size: 16px; color: #2c3e50; margin-top: 5px;">{{ ticket.project_type }}</div>
                    </div>

                    {% if ticket.message %}
                    <div>
                        <strong style="color: #7f8c8d; font-size: 12px; text-transform: uppercase;">–°–æ–æ–±—â–µ–Ω–∏–µ</strong>
                        <div style="font-size: 16px; color: #2c3e50; margin-top: 5px; line-height: 1.6;">
                            {{ ticket.message }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px; color: #7f8c8d;">
                <div>
                    <strong>–°–æ–∑–¥–∞–Ω–∞:</strong> {{ ticket.created_at.strftime('%d.%m.%Y –≤ %H:%M') }}
                </div>
                {% if ticket.updated_at %}
                <div>
                    <strong>–û–±–Ω–æ–≤–ª–µ–Ω–∞:</strong> {{ ticket.updated_at.strftime('%d.%m.%Y –≤ %H:%M') }}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
        <div>
            <h3 style="font-size: 18px; color: #2c3e50; margin-bottom: 15px;">
                –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º
            </h3>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
                <div style="margin-bottom: 20px;">
                    <strong style="display: block; margin-bottom: 10px;">–¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:</strong>
                    {% if ticket.status.value == 'new' %}
                        <span class="badge badge-new" style="font-size: 14px; padding: 8px 16px;">–ù–æ–≤–∞—è</span>
                    {% elif ticket.status.value == 'in_progress' %}
                        <span class="badge badge-in-progress" style="font-size: 14px; padding: 8px 16px;">–í —Ä–∞–±–æ—Ç–µ</span>
                    {% elif ticket.status.value == 'completed' %}
                        <span class="badge badge-completed" style="font-size: 14px; padding: 8px 16px;">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                    {% else %}
                        <span class="badge badge-cancelled" style="font-size: 14px; padding: 8px 16px;">–û—Ç–º–µ–Ω–µ–Ω–∞</span>
                    {% endif %}
                </div>

                <form method="POST" action="/admin/tickets/{{ ticket.id }}/status">
                    <div class="form-group">
                        <label>–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å:</label>
                        <select name="status" class="form-control">
                            {% for status in all_statuses %}
                            <option value="{{ status }}" {% if status == ticket.status.value %}selected{% endif %}>
                                {% if status == 'new' %}–ù–æ–≤–∞—è
                                {% elif status == 'in_progress' %}–í —Ä–∞–±–æ—Ç–µ
                                {% elif status == 'completed' %}–ó–∞–≤–µ—Ä—à–µ–Ω–∞
                                {% else %}–û—Ç–º–µ–Ω–µ–Ω–∞
                                {% endif %}
                            </option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" class="btn" style="width: 100%;">
                        –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
                    </button>
                </form>
            </div>

            <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
                <a href="mailto:{{ ticket.email }}" class="btn btn-secondary" style="text-align: center;">
                    ‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å email
                </a>
                <a href="tel:{{ ticket.phone }}" class="btn btn-secondary" style="text-align: center;">
                    üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}