{% extends "admin/base.html" %}

{% block title %}–ó–∞—è–≤–∫–∏{% endblock %}
{% block page_title %}üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∞–º–∏{% endblock %}

{% block content %}
<div class="content-box">
    <!-- –§–∏–ª—å—Ç—Ä—ã -->
    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <form method="GET" action="/admin/tickets" style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
            <!-- –ü–æ–∏—Å–∫ -->
            <div style="flex: 1; min-width: 200px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">
                    üîç –ü–æ–∏—Å–∫
                </label>
                <input 
                    type="text" 
                    name="search" 
                    placeholder="–ò–º—è –∏–ª–∏ email..."
                    value="{{ search_query }}"
                    style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px;"
                >
            </div>

            <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É -->
            <div style="min-width: 200px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px;">
                    üìä –°—Ç–∞—Ç—É—Å
                </label>
                <select 
                    name="status"
                    style="width: 100%; padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px;"
                >
                    <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                    {% for status in all_statuses %}
                    <option value="{{ status }}" {% if current_status == status %}selected{% endif %}>
                        {% if status == 'new' %}–ù–æ–≤—ã–µ
                        {% elif status == 'in_progress' %}–í —Ä–∞–±–æ—Ç–µ
                        {% elif status == 'completed' %}–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                        {% else %}–û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ
                        {% endif %}
                    </option>
                    {% endfor %}
                </select>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn" style="padding: 8px 20px;">
                    –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                </button>
                <a href="/admin/tickets" class="btn btn-secondary" style="padding: 8px 20px;">
                    –°–±—Ä–æ—Å–∏—Ç—å
                </a>
            </div>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞—è–≤–æ–∫ -->
    {% if tickets %}
    <div style="overflow-x: auto;">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ò–º—è</th>
                    <th>Email</th>
                    <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                    <th>–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for ticket in tickets %}
                <tr>
                    <td><strong>#{{ ticket.id }}</strong></td>
                    <td>{{ ticket.created_at.strftime('%d.%m.%Y') }}<br>
                        <small style="color: #95a5a6;">{{ ticket.created_at.strftime('%H:%M') }}</small>
                    </td>
                    <td>{{ ticket.name }}</td>
                    <td>{{ ticket.email }}</td>
                    <td>{{ ticket.phone }}</td>
                    <td>{{ ticket.project_type }}</td>
                    <td>
                        {% if ticket.status.value == 'new' %}
                            <span class="badge badge-new">–ù–æ–≤–∞—è</span>
                        {% elif ticket.status.value == 'in_progress' %}
                            <span class="badge badge-in-progress">–í —Ä–∞–±–æ—Ç–µ</span>
                        {% elif ticket.status.value == 'completed' %}
                            <span class="badge badge-completed">–ó–∞–≤–µ—Ä—à–µ–Ω–∞</span>
                        {% else %}
                            <span class="badge badge-cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="/admin/tickets/{{ ticket.id }}" class="btn" style="padding: 5px 15px; font-size: 12px;">
                            –û—Ç–∫—Ä—ã—Ç—å
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div style="text-align: center; padding: 60px 20px;">
        <div style="font-size: 48px; margin-bottom: 15px;">üìù</div>
        <h3 style="color: #2c3e50; margin-bottom: 10px;">–ó–∞—è–≤–æ–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
        <p style="color: #95a5a6;">
            {% if search_query or current_status %}
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
            {% else %}
            –ó–∞—è–≤–∫–∏ –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}